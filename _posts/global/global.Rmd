---
title: "Global summary"
description: |
  Identifying changes in the reproduction number, rate of spread, and doubling time during the course of the COVID-19 outbreak whilst accounting for potential biases due to delays in case reporting both nationally and subnationally. These results are impacted by changes in testing effort, increases and decreases in testing effort will increase and decrease reproduction number estimates respectively (see Methods or our [paper](https://wellcomeopenresearch.org/articles/5-112/) for further explanation).
bibliography: library.bib
output:
  distill::distill_article:
    self_contained: true
    toc: true
    toc_depth: 2
categories:
  - "Global summary"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE,
                      fig.width = 12, fig.height = 12,
                      message = FALSE,
                      warning = FALSE,
                      dpi = 400)
```


```{r load-packages, include = FALSE}
library(EpiNow2)
library(RtD3)
library(dplyr)
library(magrittr)
library(rmarkdown)
library(here)
```


```{r}
summary_table <- data.table::fread(here::here("covid-rt-estimates", "national", "cases",
                                    "summary", "summary_table.csv"))
latest_date <- readRDS(here::here("covid-rt-estimates", "national", "cases",
                                    "summary", "latest_date.rds"))
```

*Using data available up to the:* `r latest_date`

*These estimates are available for download [here](https://github.com/epiforecasts/covid-rt-estimates/tree/master/national/cases/summary). Comparable estimates based on reported deaths are available [here](https://github.com/epiforecasts/covid-rt-estimates/tree/master/national/deaths/summary).*


### Interactive summary

```{r, include = FALSE}
geoData <- rnaturalearth::ne_countries(scale = "medium", returnclass = 'sf')

geoData <- geoData %>% 
  dplyr::mutate(sovereignt = ifelse(sovereignt == 'United States of America',
                                    'United States', sovereignt))


# Define the base URL/file path for the estimates
base_url <- 'https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/'

# Read in each summary folder
rtData <- list("Cases" = RtD3::readInEpiNow2(path = paste0(base_url, "cases/summary"),
                                             region_var = "country"),
               "Deaths" = RtD3::readInEpiNow2(path = paste0(base_url, "deaths/summary"),
                                              region_var = "country"))


# Join in regional estimates
source(here::here("utils", "join_RtD3_data.R"))

rtData$Cases <- join_RtD3_data(rtData$Cases, 
                               base_url = 'https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/region/cases/summary',
                               region_id = "region")

rtData$Deaths <-join_RtD3_data(rtData$Deaths, 
                               base_url = 'https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/region/deaths/summary',
                               region_id = "region")

subnational_ref <- RtD3::getSubregionalUrls(path = "https://epiforecasts.io/covid/posts/national/",
                                            areas = c('Afghanistan', 'Brazil', 'Colombia', 'India', 
                                                      'Italy', 'Germany', 'Russia', 'United Kingdom',
                                                      'United States'))
```


```{r map, layout="l-body-outset", out.width = "100%", warning = FALSE, message = FALSE}
RtD3::summaryWidget(
  geoData = geoData,
  rtData = rtData,
  subregional_ref = subnational_ref,
  activeArea = "Global"
)
```

<br>
`r paste0("*The results of the latest reproduction number estimates (based on estimated confirmed cases with a date of infection on the ", latest_date , ") can be summarised by whether confirmed cases are likely increasing or decreasing. This represents the strength of the evidence that the reproduction number in each region is greater than or less than 1, respectively (see the [methods](https://epiforecasts.io/covid/methods.html) for details). Click on a country (or search) to see national level estimates (and a link to subnational estimates if available). This interactive visualisation is powered by RtD3[@rtd3].*")`

```{r}
standalone <- TRUE
region_path <- NULL
summary_path <- "covid-rt-estimates/national/cases/summary"
report_forecast <- TRUE
interactive <- TRUE
all_regions <- FALSE
```

```{r,  child = system.file("templates/_regional-summary.Rmd", package = "EpiNow2")}
```
