---
title: "National and Subnational estimates for Germany"
description: |
  Identifying changes in the reproduction number, rate of spread, and doubling time during the course of the COVID-19 outbreak whilst accounting for potential biases due to delays in case reporting both nationally and subnationally in Germany.
bibliography: library.bib
output:
  distill::distill_article:
    self_contained: true
    toc: true
    toc_depth: 3
---




```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      fig.height = 12, 
                      fig.width = 12,
                      dpi = 320)
```


```{r load-packages, include = FALSE}
library(EpiNow)
library(dplyr)
library(rmarkdown)
library(here)
library(stringr)
library(ggplot2)
library(sf)
```

## Expected daily cases by region

```{r}
summary_table <- readRDS("nowcast/summary/summary_table.rds")
region_codes <- readRDS("nowcast/data/region_codes.rds")

source("nowcast/utils/map_us.R")


summary_table <- summary_table %>% 
  dplyr::left_join(region_codes %>% 
                     dplyr::mutate(region = region %>% 
                                     stringr::str_replace("-", " ")), 
                   by = c("Region" = "region"))
```

```{r map, fig.width = 6, fig.height = 6, layout="l-body-outset"}
regions <- rnaturalearth::ne_states("Germany", returnclass = "sf")


regions_with_data <- regions %>%
   dplyr::left_join(summary_table,
                  by = c("iso_3166_2" = "region_code"))

map <- ggplot2::ggplot(regions_with_data) +
  ggplot2::geom_sf(ggplot2::aes(fill = `Expected change in daily cases`),
                   alpha = 0.8, size = 0.2, col = "white")


EpiNow::theme_map(
  map,
  continuous = FALSE,
  variable_label = "Expected change in daily cases",
  viridis_palette = "cividis",
  fill_labels = ggplot2::waiver()
  )
```

<br>
*Figure 1: Map of the expected change in daily cases*

## National summary

```{r}
## Control parameters for region-report
summary_tables <- 0
summary_figures <- 1
title_depth <- 3
index <- 1
region <- "germany"
path <- "_posts/global"
show_title <- FALSE
```

```{r,  child = "../../templates/_region-report.Rmd"}
```


## Regional Breakdown

### Data availability

* Case counts by date, stratified by region were downloaded from a publically available source [@NCoVUtils; @gehrcke_covid-19_2020].
* Case onset dates were estimated using case counts by date of report and a distribution of reporting delays fitted to a publically available line-list of cases reported in Germany [@kraemer2020epidemiological; @NCoVUtils].

### Limitations

* Line-list data to inform a region specific estimate of the reporting delay were not available. 


```{r} 
region_reports <- TRUE
path <- "_posts/germany"
```

```{r,  child = "../../templates/_regional-summary.Rmd"}
```

