---
title: "Methods"
description: |
  Data sources, accounting for report delays and statistical methods.
bibliography:: library.bib
output:
  distill::distill_article:
    self_contained: true
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Data

### National data sources

We used partial line-lists from each region that contained the date of symptom onset, date of confirmation and import status (imported or local) for each case [@kraemer2020epidemiological, @NCoVUtils] where available. The region reports give details of the steps taken where this data were not available. Daily case counts by date of report were extracted from the World Health Organization (WHO) situation reports for every location considered [@WorldHealthOrganization:sitrep; @EricBrown2020, @NCoVUtils]. The case counts (and partial line-lists where available) were used to assemble the daily number of local and imported cases. Where the partial line-lists and case counts disagreed, it was assumed that the partial line-lists were correct and the WHO case counts were adjusted so that the overall number of cases occurring remained the same but the number of local cases being adjusted as needed.

### Subnational data sources

Subnational data was context specific, see the subnational breakdowns for details.

## Adjusting for reporting delays

Reporting delays for each country were estimated using the corresponding partial line-list of cases. The reporting delay could not be estimated from line-list data for all regions. Region specific details are given in the individual regional reports. The estimated reporting delay was assumed to remain constant over time in each location. We fitted an exponential distribution adjusted for censoring [@Thompson:2020bc] to the observed delays using stan [@rstan]. We then took 1000 samples from the posterior distribution of the rate parameter for the exponential delay distribution and constructed a distribution of possible onset dates for each case based on their reporting date. To prevent spuriously long reporting delays, we re-sampled delays that were greater than the maximum observed delay in the observed data.

To account for censoring, i.e. cases that have not yet been confirmed but will show up in the data at a later time, we randomly sampled the true number of cases (including those not yet confirmed) assuming that the reported number of cases is drawn from a binomial distribution, where each case has independent probability $p_i$ of having been confirmed, $i$ is the number of days of the symptom onset before the report maximum observed report delay, and $p_i$ is the cumulative distribution of cases that are confirmed by day $i$ after they develop symptoms. We did not account for potential reporting biases that might occur due to changes in the growth rate of the outbreak over time.
 
##  Statistical analysis

We used the inferred number of cases to estimate the reproduction number on each day using the *EpiEstim* R package [@EpiEstim, @R]. This uses a combination of the serial interval distribution and the number of observed cases to estimate the reproduction number at each time point [@cori2013;@wallinga2004], which were then smoothed using a 7-day time window. We assumed that the serial interval was uncertain with a mean of 4.7 days (95% CrI: 3.7, 6.0) and a standard deviation of 2.9 days (95% CrI: 1.9, 4.9) [@Nishiura2020.02.03.20019497]. We used a common prior for the reproduction number with mean 2.6 and a standard deviation of  2 (inflated from 0.5 found in the reference) [@Imai:webreport3].  Where data was available, we used *EpiEstim* to adjust for imported cases [@THOMPSON2019100356]. The expected change in daily cases was defined using the proportion of samples with a reproduction number less than 1 (subcritical). It was assumed that if less than 5% of samples were subcritical then an increase in cases was definite, if less than 20% of samples were subcritical then an increase in cases was likely, if more than 80% of samples were subcritical then a decrease in cases was likely and if more than 95% of samples were subcritical then a decrease in cases was definite. For countries/regions with between 20% and 80% of samples being subcritical we could not make a statement about the likely change in cases (defined as unsure).

We estimated the rate of spread ($r$) using linear regression with time as the only exposure and logged cases as the outcome for the overall course of the outbreak [@Park2019]. The adjusted R^2 value was then used to assess the goodness of fit. In order to account for potential changes in the rate of spread over the course of the outbreak we used a 7-day sliding window to produce time-varying estimates of the rate of spread and the adjusted R^2. The doubling time was then estimated using $\text{ln}(2) \frac{1}{r}$ for each estimate of the rate of spread.

We report the 95% confidence intervals for all measures using the 2.5% and 97.5% quantiles. The analysis was conducted independently for all regions and is updated daily as new data becomes available. Confidence in our estimates is shown using the proportion of data that were derived using binomial upscaling. Code and results from this analysis can be found [here](https://epiforecasts.io/EpiNow) and [here](https://github.com/epiforecasts/covid).
